(()=>{"use strict";var t,e=function(){function e(){}return e.init=function(e){var o;if(void 0!==e){if(void 0===(o=document.getElementById(e)))throw new Error("Cannot find a canvas element of id: "+e)}else o=document.createElement("canvas"),document.body.appendChild(o);if(void 0===(t=o.getContext("webgl2")))throw new Error("Unable to initilise WebGL2");return o},e}(),o=1e-6,n="undefined"!=typeof Float32Array?Float32Array:Array;function r(){var t=new n(16);return n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var i=function(t,e,o,n,r,i,s){var a=1/(e-o),u=1/(n-r),m=1/(i-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*m,t[11]=0,t[12]=(e+o)*a,t[13]=(r+n)*u,t[14]=(s+i)*m,t[15]=1,t};const s=function(t,e){this.Message=t,this.Handler=e},a=function(){function t(){}return t.addSubscription=function(e,o){void 0===t.m_Subscriptions[e]&&(t.m_Subscriptions[e]=[]),-1!==t.m_Subscriptions[e].indexOf(o)?console.warn("Attempting to add duplicate handler to code ".concat(e,". Subscription not added")):t.m_Subscriptions[e].push(o)},t.removeSubscription=function(e,o){if(void 0!==t.m_Subscriptions[e]){var n=t.m_Subscriptions[e].indexOf(o);-1!==n&&t.m_Subscriptions[e].splice(n,1)}else console.warn("Can't unsubscribe thandelr from code ".concat(e,", because this code is not subscribed to."))},t.post=function(e){console.log("Message posted",e),void 0!==t.m_Subscriptions[e.Code]&&t.m_Subscriptions[e.Code].forEach((function(o){e.Priority===u.HIGH?o.onMessage(e):t.m_MessageQueue.push(new s(e,o))}))},t.update=function(e){if(0!=t.m_MessageQueue.length)for(var o=Math.min(t.m_QueueLimitPerFrame,t.m_MessageQueue.length),n=0;n<o;++n){var r=t.m_MessageQueue.pop();r.Handler.onMessage(r.Message)}},t.m_Subscriptions={},t.m_QueueLimitPerFrame=10,t.m_MessageQueue=[],t}();var u;!function(t){t[t.NORMAL=0]="NORMAL",t[t.HIGH=1]="HIGH"}(u||(u={}));const m=function(){function t(t,e,o,n){void 0===n&&(n=u.NORMAL),this.Code=t,this.Sender=e,this.Priority=n,this.Context=o}return t.send=function(e,o,n){a.post(new t(e,o,n))},t.sendPriority=function(e,o,n){a.post(new t(e,o,n,u.HIGH))},t.subscribe=function(t,e){a.addSubscription(t,e)},t.unsubscribe=function(t,e){a.removeSubscription(t,e)},t}();var c=function(){function t(t,e){this.Name=t,this.Data=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this.Data.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.Data.height},enumerable:!1,configurable:!0}),t}();const f=function(){function t(){}return Object.defineProperty(t.prototype,"supportedExts",{get:function(){return["png","gif","jpg"]},enumerable:!1,configurable:!0}),t.prototype.loadAsset=function(t){var e=new Image;e.onload=this.onImageLoaded.bind(this,t,e),e.src=t},t.prototype.onImageLoaded=function(t,e){console.log("onImage loaded ".concat(t,"/").concat(e));var o=new c(t,e);_.onAssetLoaded(o)},t}();var h=function(t,e){this.Name=t,this.Data=e};const d=function(){function t(){}return Object.defineProperty(t.prototype,"supportedExts",{get:function(){return["json"]},enumerable:!1,configurable:!0}),t.prototype.loadAsset=function(t){var e=new XMLHttpRequest;e.open("GET",t),e.addEventListener("load",this.onJsonLoaded.bind(this,t,e)),e.send()},t.prototype.onJsonLoaded=function(t,e){if(console.log("onJsonLoaded loaded",t,e),e.readyState===e.DONE){var o=JSON.parse(e.responseText),n=new h(t,o);_.onAssetLoaded(n)}},t}();var p="MSG_ASSET_LOADER_ASSET_LOADED::";const _=function(){function t(){}return t.init=function(){t.m_Loaders.push(new f),t.m_Loaders.push(new d)},t.registerLoader=function(e){t.m_Loaders.push(e)},t.onAssetLoaded=function(e){t.m_LoadedAssets[e.Name]=e,m.sendPriority(p+e.Name,this,e)},t.loadAsset=function(e){for(var o=e.split(".").pop().toLowerCase(),n=0,r=t.m_Loaders;n<r.length;n++){var i=r[n];if(-1!==i.supportedExts.indexOf(o))return void i.loadAsset(e)}console.warn("Unable to load asset with extension ".concat(o,", because there is no loader associated with it."))},t.isAssetLoaded=function(e){return void 0!==t.m_LoadedAssets[e]},t.getAsset=function(e){var o=t.m_LoadedAssets[e];if(void 0!==o)return o;t.loadAsset(e)},t.m_Loaders=[],t.m_LoadedAssets={},t}();var l,y=function(){function e(t){this.m_Attributes={},this.m_Uniforms={},this.m_Name=t}return Object.defineProperty(e.prototype,"name",{get:function(){return this.m_Name},enumerable:!1,configurable:!0}),e.prototype.load=function(e,o){var n=this.loadShader(e,t.VERTEX_SHADER),r=this.loadShader(o,t.FRAGMENT_SHADER);this.createShaderProgram(n,r),this.detectAttributes(),this.detectUniforms()},e.prototype.use=function(){t.useProgram(this.m_Program)},e.prototype.getAttributeLocation=function(t){if(void 0===this.m_Attributes[t])throw new Error("error getting attribute '".concat(t,"' :for ").concat(this.name));return this.m_Attributes[t]},e.prototype.getUniformLocation=function(t){if(void 0===this.m_Uniforms[t])throw new Error("error getting uniform '".concat(t,"' :for ").concat(this.name));return this.m_Uniforms[t]},e.prototype.loadShader=function(e,o){var n=t.createShader(o);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(n);throw new Error("error compiling shader '".concat(this.m_Name,"' : ").concat(r))}return n},e.prototype.createShaderProgram=function(e,o){if(this.m_Program=t.createProgram(),t.attachShader(this.m_Program,e),t.attachShader(this.m_Program,o),t.linkProgram(this.m_Program),!t.getProgramParameter(this.m_Program,t.LINK_STATUS)){var n=t.getProgramInfoLog(this.m_Program);throw new Error("error linking shader ".concat(this.m_Name," : ").concat(n))}},e.prototype.detectAttributes=function(){for(var e=t.getProgramParameter(this.m_Program,t.ACTIVE_ATTRIBUTES),o=0;o<e;++o){var n=t.getActiveAttrib(this.m_Program,o);if(!n)break;this.m_Attributes[n.name]=t.getAttribLocation(this.m_Program,n.name)}},e.prototype.detectUniforms=function(){for(var e=t.getProgramParameter(this.m_Program,t.ACTIVE_UNIFORMS),o=0;o<e;++o){var n=t.getActiveUniform(this.m_Program,o);if(!n)break;this.m_Uniforms[n.name]=t.getUniformLocation(this.m_Program,n.name)}},e}(),v=(l=function(t,e){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},l(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});const g=function(t){function e(){var e=t.call(this,"basic")||this;return e.load(e.getVertexSource(),e.getFragmentSource()),e}return v(e,t),e.prototype.getVertexSource=function(){return"#version 300 es\n\n        in vec4 a_position;\n        in vec2 a_texCoord;\n\n        uniform mat4 u_projection;\n        uniform mat4 u_model;\n\n        out vec2 v_texCoord;\n        \n        void main() {\n            gl_Position =  u_projection * u_model * a_position;\n            v_texCoord = a_texCoord;\n        }"},e.prototype.getFragmentSource=function(){return"#version 300 es\n\n        precision highp float;\n\n        uniform vec4 u_tint;\n        uniform sampler2D u_diffuse;\n\n        out vec4 outColor;\n        in vec2 v_texCoord;\n        \n        \n        void main() {\n            outColor = u_tint * texture(u_diffuse, v_texCoord);\n        }"},e}(y);var b=function(t){this.m_ReferenceCount=1,this.m_Material=t},w=function(){function t(){}return t.registerMaterial=function(e){void 0===t.m_Materials[e.name]&&(t.m_Materials[e.name]=new b(e))},t.getMaterial=function(e){return void 0===t.m_Materials[e]?void 0:(t.m_Materials[e].m_ReferenceCount++,t.m_Materials[e].m_Material)},t.releaseMaterial=function(e){void 0===t.m_Materials[e]?console.warn("Can't release material that hasn't been registered"):(t.m_Materials[e].m_ReferenceCount--,t.m_Materials[e].m_ReferenceCount<1&&(t.m_Materials[e].m_Material.destroy(),t.m_Materials[e].m_Material=void 0,delete t.m_Materials[e]))},t.m_Materials={},t}();const T=w;var A=0,S=0,P=new Uint8Array([255,255,255,255]);const O=function(){function e(e,o,n){void 0===o&&(o=1),void 0===n&&(n=1),this.m_IsLoaded=!1,this.m_Name=e,this.m_Width=o,this.m_Height=n,this.m_Handle=t.createTexture(),m.subscribe(p+this.m_Name,this),this.bind(),t.texImage2D(t.TEXTURE_2D,A,t.RGBA,1,1,S,t.RGBA,t.UNSIGNED_BYTE,P);var r=_.getAsset(this.m_Name);void 0!==r&&this.loadTextureFromAsset(r)}return e.prototype.destroy=function(){t.deleteTexture(this.m_Handle)},Object.defineProperty(e.prototype,"name",{get:function(){return this.m_Name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return this.m_IsLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.m_Width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.m_Height},enumerable:!1,configurable:!0}),e.prototype.bind=function(){t.bindTexture(t.TEXTURE_2D,this.m_Handle)},e.prototype.unbind=function(){t.bindTexture(t.TEXTURE_2D,void 0)},e.prototype.activateAndBind=function(e){void 0===e&&(e=0),t.activeTexture(t.TEXTURE0+e),this.bind()},e.prototype.onMessage=function(t){t.Code===p+this.m_Name&&(console.debug(this.m_Name+" loaded:",t.Context),this.loadTextureFromAsset(t.Context))},e.prototype.loadTextureFromAsset=function(e){this.m_Width=e.width,this.m_Height=e.height,this.bind(),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,A,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.Data),this.m_IsLoaded=!0},e}();var E=function(t){this.ReferenceNode=1,this.Texture=t};const x=function(){function t(){}return t.getTexture=function(e){if(void 0===t.m_Textures[e]){var o=new O(e);t.m_Textures[e]=new E(o)}else t.m_Textures[e].ReferenceNode++;return t.m_Textures[e].Texture},t.releaseTexture=function(e){t.m_Textures[e],void 0===t.m_Textures[e]?console.warn("A texture name ".concat(e," doesn't exist, hence can't be released")):(t.m_Textures[e].ReferenceNode--,t.m_Textures[e].ReferenceNode<1&&(t.m_Textures[e].Texture.destroy(),t.m_Textures[e]=void 0,delete t.m_Textures[e]))},t.m_Textures={},t}(),M=function(){function t(t,e,o){this.m_Name=t,this.m_DiffuseTextureName=e,this.m_Tint=o,void 0!==this.m_DiffuseTextureName&&(this.m_DiffuseTexture=x.getTexture(this.m_DiffuseTextureName))}return t.prototype.destroy=function(){x.releaseTexture(this.m_DiffuseTextureName),this.m_DiffuseTexture=void 0},Object.defineProperty(t.prototype,"name",{get:function(){return this.m_Name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseTexture",{get:function(){return this.m_DiffuseTexture},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tint",{get:function(){return this.m_Tint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diffuseTexName",{get:function(){return this.m_DiffuseTextureName},set:function(t){void 0!==this.m_DiffuseTexture&&x.releaseTexture(this.m_DiffuseTextureName),this.m_DiffuseTextureName=t,void 0!==this.m_DiffuseTextureName&&x.getTexture(this.m_DiffuseTextureName)},enumerable:!1,configurable:!0}),t}(),L=function(){function t(t,e,o,n){void 0===t&&(t=255),void 0===e&&(e=255),void 0===o&&(o=255),void 0===n&&(n=255),this.m_R=t,this.m_G=e,this.m_B=o,this.m_A=n}return Object.defineProperty(t.prototype,"r",{get:function(){return this.m_R},set:function(t){this.m_R=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rFloat",{get:function(){return this.m_R/255},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this.m_G},set:function(t){this.m_G=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gFloat",{get:function(){return this.m_G/255},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this.m_B},set:function(t){this.m_B=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bFloat",{get:function(){return this.m_B/255},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"a",{get:function(){return this.m_A},set:function(t){this.m_A=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"aFloat",{get:function(){return this.m_A/255},enumerable:!1,configurable:!0}),t.prototype.toArray=function(){return[this.m_R,this.m_G,this.m_B,this.m_A]},t.prototype.toFloatArray=function(){return[this.m_R/255,this.m_G/255,this.m_B/255,this.m_A/255]},t.prototype.toFloat32Array=function(){return new Float32Array(this.toFloatArray())},t.white=function(){return new t(255,255,255,255)},t.black=function(){return new t(0,0,0,255)},t.red=function(){return new t(255,0,0,255)},t.green=function(){return new t(0,255,0,255)},t.blue=function(){return new t(0,0,255,255)},t}();function F(){var t=new n(2);return n!=Float32Array&&(t[0]=0,t[1]=0),t}function D(t,e){return t[0]=e[0],t[1]=e[1],t}function C(t,e,o){return t[0]=e,t[1]=o,t}var N;F(),function(t){t[t.LEFT=97]="LEFT",t[t.UP=119]="UP",t[t.RIGHT=100]="RIGHT",t[t.DOWN=115]="DOWN"}(N||(N={}));var R=function(t,e,o){this.leftDown=t,this.rightDown=e,this.position=o};const B=function(){function t(){}return t.init=function(){for(var e=0;e<255;++e)t.m_Keys[e]=!1;window.addEventListener("keydown",t.onKeyDown),window.addEventListener("keyup",t.onKeyUp),window.addEventListener("mousemove",t.onMouseMove),window.addEventListener("mousedown",t.onMouseDown),window.addEventListener("mouseup",t.onMouseUp)},t.getMousePos=function(){return C(F(),t.m_MouseX,t.m_MouseY)},t.IsKeyDown=function(e){return t.m_Keys[e]},t.onKeyDown=function(e){return t.m_Keys[e.key.charCodeAt(0)]=!0,!0},t.onKeyUp=function(e){return t.m_Keys[e.key.charCodeAt(0)]=!1,!0},t.onMouseMove=function(e){t.m_PreviousMouseX=t.m_MouseX,t.m_PreviousMouseY=t.m_MouseY,t.m_MouseX=e.clientX,t.m_MouseY=e.clientY},t.onMouseDown=function(e){0===e.button?t.m_LeftDown=!0:2===e.button&&(t.m_RightDown=!0),m.send("MOUSE_DOWN",this,new R(t.m_LeftDown,t.m_RightDown,t.getMousePos()))},t.onMouseUp=function(e){0===e.button?t.m_LeftDown=!1:2===e.button&&(t.m_RightDown=!1),m.send("MOUSE_UP",this,new R(t.m_LeftDown,t.m_RightDown,t.getMousePos()))},t.m_Keys=[],t.m_LeftDown=!1,t.m_RightDown=!1,t}();var j=function(){function t(t){this.m_Data=t,this.name=this.m_Data.name}return t.prototype.setOwner=function(t){this.m_Owner=t},t.prototype.update=function(t){},t.prototype.apply=function(t){},t}(),I=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),U=function(){function t(){this.speed=.1}return t.prototype.setFromJson=function(t){if(void 0===t.name)throw new Error("Behaviour data is missing a name.");this.name=String(t.name),void 0!==t.speed&&(this.speed=Number(t.speed))},t}(),H=function(){function t(){}return Object.defineProperty(t.prototype,"type",{get:function(){return"keyboardMovement"},enumerable:!1,configurable:!0}),t.prototype.buildFromJson=function(t){var e=new U;return e.setFromJson(t),new G(e)},t}(),G=function(t){function e(e){var o=t.call(this,e)||this;return o.speed=.1,o.speed=e.speed,o}return I(e,t),e.prototype.update=function(e){B.IsKeyDown(N.LEFT)&&(this.m_Owner.Transform.Position[0]-=this.speed),B.IsKeyDown(N.RIGHT)&&(this.m_Owner.Transform.Position[0]+=this.speed),B.IsKeyDown(N.UP)&&(this.m_Owner.Transform.Position[1]-=this.speed),B.IsKeyDown(N.DOWN)&&(this.m_Owner.Transform.Position[1]+=this.speed),t.prototype.update.call(this,e)},e}(j),V=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),W=function(){function t(){this.rotation=0}return t.prototype.setFromJson=function(t){if(void 0===t.name)throw new Error("Behaviour data is missing a name.");this.name=String(t.name),void 0!==t.rotation&&(this.rotation=Number(t.rotation))},t}(),k=function(){function t(){}return Object.defineProperty(t.prototype,"type",{get:function(){return"rotation"},enumerable:!1,configurable:!0}),t.prototype.buildFromJson=function(t){var e=new W;return e.setFromJson(t),new J(e)},t}(),J=function(t){function e(e){var o=t.call(this,e)||this;return o.m_Rotation=e.rotation,o}return V(e,t),e.prototype.update=function(e){this.m_Owner.Transform.Rotation+=this.m_Rotation,t.prototype.update.call(this,e)},e}(j),z=function(){function t(){}return t.init=function(){t.registerBuilder(new k),t.registerBuilder(new H)},t.registerBuilder=function(e){t.m_RegisteredBuilders[e.type]=e},t.extractBehaviour=function(e){if(void 0!==e.type){if(void 0!==t.m_RegisteredBuilders[String(e.type)])return t.m_RegisteredBuilders[String(e.type)].buildFromJson(e);throw new Error("Behaviour manager is missing type or builder is not registered for this type")}},t.m_RegisteredBuilders={},t}();function X(){var t=new n(3);return n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function K(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Y(t,e,o,n){return t[0]=e,t[1]=o,t[2]=n,t}X();var q=function(){},Q=function(){function e(e,o,n){switch(void 0===e&&(e=t.FLOAT),void 0===o&&(o=t.ARRAY_BUFFER),void 0===n&&(n=t.TRIANGLES),this.m_HasAttributeLocation=!1,this.m_Data=[],this.m_Attributes=[],this.m_ElementSize=0,this.m_DataType=e,this.m_TargetBufferType=o,this.m_Mode=n,this.m_DataType){case t.FLOAT:case t.INT:case t.UNSIGNED_INT:this.m_TypeSize=4;break;case t.SHORT:case t.UNSIGNED_SHORT:this.m_TypeSize=2;break;case t.BYTE:case t.UNSIGNED_BYTE:this.m_TypeSize=1;break;default:throw new Error("Unrecognised data type ".concat(e.toString()))}this.m_GLBuffer=t.createBuffer(),this.m_VAO=t.createVertexArray()}return e.prototype.destroy=function(){t.deleteBuffer(this.m_GLBuffer)},e.prototype.bind=function(e){var o=this;void 0===e&&(e=!1),t.bindVertexArray(this.m_VAO),t.bindBuffer(this.m_TargetBufferType,this.m_GLBuffer),this.m_HasAttributeLocation&&this.m_Attributes.forEach((function(n){t.vertexAttribPointer(n.location,n.size,o.m_DataType,e,o.m_Stride,n.offset*o.m_TypeSize),t.enableVertexAttribArray(n.location)}))},e.prototype.bindVAO=function(){t.bindVertexArray(this.m_VAO)},e.prototype.unbind=function(){t.bindBuffer(t.ARRAY_BUFFER,void 0),t.bindVertexArray(null)},e.prototype.addAttributeLocation=function(t){this.m_HasAttributeLocation=!0,t.offset=this.m_ElementSize,this.m_Attributes.push(t),this.m_ElementSize+=t.size,this.m_Stride=this.m_ElementSize*this.m_TypeSize},e.prototype.pushBackData=function(t){var e=this;t.forEach((function(t){e.m_Data.push(t)}))},e.prototype.clearData=function(){this.m_Data.length=0},e.prototype.setData=function(t){this.clearData(),this.pushBackData(t)},e.prototype.upload=function(){var e;switch(t.bindBuffer(this.m_TargetBufferType,this.m_GLBuffer),this.m_DataType){case t.FLOAT:e=new Float32Array(this.m_Data);break;case t.INT:e=new Int32Array(this.m_Data);break;case t.UNSIGNED_INT:e=new Uint32Array(this.m_Data);break;case t.SHORT:e=new Int16Array(this.m_Data);break;case t.UNSIGNED_SHORT:e=new Uint16Array(this.m_Data);break;case t.BYTE:e=new Int8Array(this.m_Data);break;case t.UNSIGNED_BYTE:e=new Uint8Array(this.m_Data)}t.bufferData(this.m_TargetBufferType,e,t.STATIC_DRAW)},e.prototype.draw=function(){this.m_TargetBufferType===t.ARRAY_BUFFER?t.drawArrays(this.m_Mode,0,this.m_Data.length/this.m_ElementSize):this.m_TargetBufferType===t.ELEMENT_ARRAY_BUFFER&&t.drawElements(this.m_Mode,this.m_Data.length,this.m_DataType,0)},e}();const Z=function(){function t(t,e,o,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===r&&(r=0),this.Position=X(),this.TexCoords=F(),Y(this.Position,t,e,o),C(this.TexCoords,n,r)}return t.prototype.toArray=function(){var t,e,o=[];return t=[this.Position[0],this.Position[1],this.Position[2]],o=o.concat(t),e=[this.TexCoords[0],this.TexCoords[1]],o.concat(e)},t.prototype.toFloat32Arr=function(){return new Float32Array(this.toArray())},t}();const $=function(){function e(t,e,o,n){void 0===o&&(o=100),void 0===n&&(n=100),this.m_Origin=X(),this.m_Model=r(),this.m_Vertices=[],this.m_Position=X(),this.m_Name=t,this.m_Height=n,this.m_Width=o,this.m_MaterialName=e,this.m_Material=T.getMaterial(this.m_MaterialName)}return e.prototype.destroy=function(){this.m_Buffer.destroy(),T.releaseMaterial(this.m_MaterialName),this.m_Material=void 0,this.m_MaterialName=void 0},Object.defineProperty(e.prototype,"name",{get:function(){return this.m_Name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"origin",{get:function(){return this.origin},set:function(t){Y(this.m_Origin,t[0],t[1],t[2]),this.recalculateVertices()},enumerable:!1,configurable:!0}),e.prototype.load=function(){this.m_Buffer=new Q;var t=new q;t.location=0,t.size=3,this.m_Buffer.addAttributeLocation(t);var e=new q;e.location=1,e.size=2,this.m_Buffer.addAttributeLocation(e),this.m_Buffer.bind(),this.calcalateVertices()},e.prototype.update=function(t){},e.prototype.draw=function(e,o){var n=e.getUniformLocation("u_model");t.uniformMatrix4fv(n,!1,o);var r=e.getUniformLocation("u_tint");if(t.uniform4fv(r,this.m_Material.tint.toFloat32Array()),void 0!==this.m_Material.diffuseTexture){this.m_Material.diffuseTexture.activateAndBind(0);var i=e.getUniformLocation("u_diffuse");t.uniform1i(i,0)}this.m_Buffer.bindVAO(),this.m_Buffer.draw()},e.prototype.calcalateVertices=function(){var t=-this.m_Width*this.m_Origin[0],e=this.m_Width*(1-this.m_Origin[0]),o=-this.m_Height*this.m_Origin[1],n=this.m_Height*(1-this.m_Origin[1]);this.m_Vertices=[new Z(t,o,0,0,0),new Z(t,n,0,0,1),new Z(e,n,0,1,1),new Z(e,n,0,1,1),new Z(e,o,0,1,0),new Z(t,o,0,0,0)];for(var r=0,i=this.m_Vertices;r<i.length;r++){var s=i[r];this.m_Buffer.pushBackData(s.toArray())}this.m_Buffer.upload(),this.m_Buffer.unbind()},e.prototype.recalculateVertices=function(){var t=-this.m_Width*this.m_Origin[0],e=this.m_Width*(1-this.m_Origin[0]),o=-this.m_Height*this.m_Origin[1],n=this.m_Height*(1-this.m_Origin[1]);Y(this.m_Vertices[0].Position,t,o,0),Y(this.m_Vertices[1].Position,t,n,0),Y(this.m_Vertices[2].Position,e,n,0),Y(this.m_Vertices[3].Position,e,n,0),Y(this.m_Vertices[4].Position,e,o,0),Y(this.m_Vertices[5].Position,t,o,0),this.m_Buffer.clearData();for(var r=0,i=this.m_Vertices;r<i.length;r++){var s=i[r];this.m_Buffer.pushBackData(s.toArray())}this.m_Buffer.upload(),this.m_Buffer.unbind()},e}();var tt=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),et=function(t,e){this.Max=e,this.Min=t};const ot=function(t){function e(e,o,n,r,i,s,a,u){void 0===n&&(n=100),void 0===r&&(r=100),void 0===i&&(i=10),void 0===s&&(s=10),void 0===a&&(a=1),void 0===u&&(u=[]);var c=t.call(this,e,o,n,r)||this;return c.m_FrameTime=333,c.m_FrameUVs=[],c.m_CurrentFrame=0,c.m_CurrentTime=0,c.m_AssetWidth=2,c.m_AssetHeight=2,c.m_AssetLoaded=!1,c.m_FrameWidth=i,c.m_FrameHeight=s,c.m_FrameCount=a,c.m_FrameSequance=u,m.subscribe(p+c.m_Material.diffuseTexName,c),c}return tt(e,t),e.prototype.onMessage=function(t){if(t.Code===p+this.m_Material.diffuseTexName){this.m_AssetLoaded=!0;var e=t.Context;this.m_AssetWidth=e.width,this.m_AssetHeight=e.height,this.calculateUVs()}},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.load=function(){t.prototype.load.call(this)},e.prototype.update=function(e){if(this.m_AssetLoaded){if(this.m_CurrentTime+=e,this.m_CurrentTime>this.m_FrameTime){this.m_CurrentFrame++,this.m_CurrentTime=0,this.m_CurrentFrame>=this.m_FrameSequance.length&&(this.m_CurrentFrame=0);var o=this.m_FrameSequance[this.m_CurrentFrame];D(this.m_Vertices[0].TexCoords,this.m_FrameUVs[o].Min),C(this.m_Vertices[1].TexCoords,this.m_FrameUVs[o].Min[0],this.m_FrameUVs[o].Max[1]),D(this.m_Vertices[2].TexCoords,this.m_FrameUVs[o].Max),D(this.m_Vertices[3].TexCoords,this.m_FrameUVs[o].Max),C(this.m_Vertices[4].TexCoords,this.m_FrameUVs[o].Max[0],this.m_FrameUVs[o].Min[1]),D(this.m_Vertices[5].TexCoords,this.m_FrameUVs[o].Min),this.m_Buffer.clearData();for(var n=0,r=this.m_Vertices;n<r.length;n++){var i=r[n];this.m_Buffer.pushBackData(i.toArray())}this.m_Buffer.upload(),this.m_Buffer.unbind()}t.prototype.update.call(this,e)}},e.prototype.calculateUVs=function(){for(var t=0,e=0,o=0;o<this.m_FrameCount;++o){(t+=o*this.m_FrameWidth)>this.m_AssetWidth&&(e++,t=0);var n=this.m_AssetWidth,r=this.m_AssetHeight,i=o*this.m_FrameWidth/n,s=e*this.m_FrameHeight/r,a=F();C(a,i,s);var u=(o*this.m_FrameWidth+this.m_FrameWidth)/n,m=(e*this.m_FrameHeight+this.m_FrameHeight)/r,c=F();C(c,u,m),this.m_FrameUVs.push(new et(a,c))}},e}($),nt=function(){function t(t){this.m_Data=t,this.name=t.name}return Object.defineProperty(t.prototype,"owner",{get:function(){return this.m_Owner},enumerable:!1,configurable:!0}),t.prototype.setOwner=function(t){this.m_Owner=t},t.prototype.load=function(){},t.prototype.update=function(t){},t.prototype.render=function(t){},t}();var rt=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),it=function(){function t(){this.origin=X()}return t.prototype.setFromJson=function(t){void 0!==t.name&&(this.name=String(t.name)),void 0!==t.name&&(this.materialName=String(t.materialName)),void 0!==t.origin&&Y(this.origin,t.origin[0],t.origin[1],t.origin[2])},t}(),st=function(){function t(){}return Object.defineProperty(t.prototype,"type",{get:function(){return"sprite"},enumerable:!1,configurable:!0}),t.prototype.buildFromJson=function(t){var e=new it;return e.setFromJson(t),new at(e)},t}(),at=function(t){function e(e){var n,r,i,s,a,u,m,c,f=t.call(this,e)||this;return f.m_Sprite=new $(f.name,e.materialName),n=X(),r=e.origin,i=n[0],s=n[1],a=n[2],u=r[0],m=r[1],c=r[2],Math.abs(i-u)<=o*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(s-m)<=o*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-c)<=o*Math.max(1,Math.abs(a),Math.abs(c))||Y(f.m_Sprite.origin,e.origin[0],e.origin[1],e.origin[2]),f}return rt(e,t),e.prototype.load=function(){this.m_Sprite.load()},e.prototype.render=function(e){this.m_Sprite.draw(e,this.m_Owner.worldMatrix),t.prototype.render.call(this,e)},e}(nt),ut=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),mt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.FrameSequence=[],e}return ut(e,t),e.prototype.setFromJson=function(e){if(t.prototype.setFromJson.call(this,e),void 0===e.FrameWidth)throw new Error("AnimatedSpriteComponent is missng FrameWidth");if(this.FrameWidth=Number(e.FrameWidth),void 0===e.FrameHeight)throw new Error("AnimatedSpriteComponent is missng FrameHeight");if(this.FrameHeight=Number(e.FrameHeight),void 0===e.FrameCount)throw new Error("AnimatedSpriteComponent is missng FrameCount");if(this.FrameCount=Number(e.FrameCount),void 0===e.FrameSequence)throw new Error("AnimatedSpriteComponent is missng FrameSequence");this.FrameSequence=e.FrameSequence},e}(it),ct=function(){function t(){}return Object.defineProperty(t.prototype,"type",{get:function(){return"animatedSprite"},enumerable:!1,configurable:!0}),t.prototype.buildFromJson=function(t){var e=new mt;return e.setFromJson(t),new ft(e)},t}(),ft=function(t){function e(e){var o=t.call(this,e)||this;return o.m_Sprite=new ot(o.name,e.materialName,e.FrameWidth,e.FrameHeight,e.FrameWidth,e.FrameHeight,e.FrameCount,e.FrameSequence),o}return ut(e,t),e.prototype.load=function(){this.m_Sprite.load()},e.prototype.update=function(e){t.prototype.update.call(this,e),this.m_Sprite.update(e)},e.prototype.render=function(e){this.m_Sprite.draw(e,this.m_Owner.worldMatrix),t.prototype.render.call(this,e)},e}(nt),ht=function(){function t(){}return t.init=function(){t.registerBuilder(new st),t.registerBuilder(new ct)},t.registerBuilder=function(e){t.m_RegisteredBuilders[e.type]=e},t.extractComponent=function(e){if(void 0!==e.type){if(void 0!==t.m_RegisteredBuilders[String(e.type)])return t.m_RegisteredBuilders[String(e.type)].buildFromJson(e);throw new Error("Component manager is missing type or builder is not registered for this type")}},t.m_RegisteredBuilders={},t}(),dt=function(){function t(){this.Position=X(),this.Rotation=0,this.Scale=Y(X(),1,1,1)}return t.prototype.copyFrom=function(t){K(this.Position,t.Position),this.Rotation=t.Rotation,K(this.Scale,t.Scale)},t.prototype.getTransformationMatrix=function(){var t,e,o,n,i,s,a,u,m,c,f,h,d,p,_,l,y,v,g=(t=r(),e=r(),l=(o=this.Position)[0],y=o[1],v=o[2],e===t?(t[12]=e[0]*l+e[4]*y+e[8]*v+e[12],t[13]=e[1]*l+e[5]*y+e[9]*v+e[13],t[14]=e[2]*l+e[6]*y+e[10]*v+e[14],t[15]=e[3]*l+e[7]*y+e[11]*v+e[15]):(n=e[0],i=e[1],s=e[2],a=e[3],u=e[4],m=e[5],c=e[6],f=e[7],h=e[8],d=e[9],p=e[10],_=e[11],t[0]=n,t[1]=i,t[2]=s,t[3]=a,t[4]=u,t[5]=m,t[6]=c,t[7]=f,t[8]=h,t[9]=d,t[10]=p,t[11]=_,t[12]=n*l+u*y+h*v+e[12],t[13]=i*l+m*y+d*v+e[13],t[14]=s*l+c*y+p*v+e[14],t[15]=a*l+f*y+_*v+e[15]),t);return function(t,e,o){var n=Math.sin(o),r=Math.cos(o),i=e[0],s=e[1],a=e[2],u=e[3],m=e[4],c=e[5],f=e[6],h=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*r+m*n,t[1]=s*r+c*n,t[2]=a*r+f*n,t[3]=u*r+h*n,t[4]=m*r-i*n,t[5]=c*r-s*n,t[6]=f*r-a*n,t[7]=h*r-u*n}(g,g,this.Rotation),function(t,e,o){var n=o[0],r=o[1],i=o[2];t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(g,g,this.Scale),g},t.prototype.setFromJson=function(t){void 0!==t.position&&Y(this.Position,t.position.x,t.position.y,t.position.z),void 0!==t.rotation&&(this.Rotation=t.rotation),void 0!==t.scale&&Y(this.Scale,t.scale.x,t.scale.y,t.scale.z)},t}();const pt=dt;var _t=function(){function t(t,e,o){this.m_Children=[],this.m_IsLoaded=!1,this.m_LocalMatrix=r(),this.m_WorldMatrix=r(),this.m_Components=[],this.m_Behaviours=[],this.Transform=new pt,this.m_Id=t,this.Name=e,this.m_Scene=o}return Object.defineProperty(t.prototype,"id",{get:function(){return this.m_Id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.m_Parent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldMatrix",{get:function(){return this.m_WorldMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this.m_IsLoaded},enumerable:!1,configurable:!0}),t.prototype.addChild=function(t){t.m_Parent=this,this.m_Children.push(t),t.onAdded(this.m_Scene)},t.prototype.removeChild=function(t){var e=this.m_Children.indexOf(t);-1!==e&&(t.m_Parent=void 0,this.m_Children.splice(e,1))},t.prototype.getObjectByName=function(t){if(this.Name===t)return this;for(var e=0,o=this.m_Children;e<o.length;e++){var n=o[e].getObjectByName(t);if(void 0!==n)return n}},t.prototype.addComponent=function(t){this.m_Components.push(t),t.setOwner(this)},t.prototype.addBehaviour=function(t){this.m_Behaviours.push(t),t.setOwner(this)},t.prototype.load=function(){this.m_IsLoaded=!0;for(var t=0,e=this.m_Components;t<e.length;t++)e[t].load();for(var o=0,n=this.m_Children;o<n.length;o++)n[o].load()},t.prototype.update=function(t){this.m_LocalMatrix=this.Transform.getTransformationMatrix(),this.updateWorldMatrix(void 0!==this.m_Parent?this.m_Parent.worldMatrix:void 0);for(var e=0,o=this.m_Components;e<o.length;e++)o[e].update(t);for(var n=0,r=this.m_Behaviours;n<r.length;n++)r[n].update(t);for(var i=0,s=this.m_Children;i<s.length;i++)s[i].update(t)},t.prototype.render=function(t){for(var e=0,o=this.m_Components;e<o.length;e++)o[e].render(t);for(var n=0,r=this.m_Children;n<r.length;n++)r[n].render(t)},t.prototype.updateWorldMatrix=function(t){var e,o;void 0!==t?function(t,e,o){var n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],u=e[5],m=e[6],c=e[7],f=e[8],h=e[9],d=e[10],p=e[11],_=e[12],l=e[13],y=e[14],v=e[15],g=o[0],b=o[1],w=o[2],T=o[3];t[0]=g*n+b*a+w*f+T*_,t[1]=g*r+b*u+w*h+T*l,t[2]=g*i+b*m+w*d+T*y,t[3]=g*s+b*c+w*p+T*v,g=o[4],b=o[5],w=o[6],T=o[7],t[4]=g*n+b*a+w*f+T*_,t[5]=g*r+b*u+w*h+T*l,t[6]=g*i+b*m+w*d+T*y,t[7]=g*s+b*c+w*p+T*v,g=o[8],b=o[9],w=o[10],T=o[11],t[8]=g*n+b*a+w*f+T*_,t[9]=g*r+b*u+w*h+T*l,t[10]=g*i+b*m+w*d+T*y,t[11]=g*s+b*c+w*p+T*v,g=o[12],b=o[13],w=o[14],T=o[15],t[12]=g*n+b*a+w*f+T*_,t[13]=g*r+b*u+w*h+T*l,t[14]=g*i+b*m+w*d+T*y,t[15]=g*s+b*c+w*p+T*v}(this.worldMatrix,t,this.m_LocalMatrix):(e=this.m_WorldMatrix,o=this.m_LocalMatrix,e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15])},t.prototype.onAdded=function(t){this.m_Scene=t},t}();const lt=_t;const yt=function(){function t(){this.m_RootObj=new lt(0,"__ROOT__",this)}return Object.defineProperty(t.prototype,"root",{get:function(){return this.m_RootObj},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this.m_RootObj.isLoaded},enumerable:!1,configurable:!0}),t.prototype.addObject=function(t){this.m_RootObj.addChild(t)},t.prototype.getObjectByName=function(t){return this.m_RootObj.getObjectByName(t)},t.prototype.load=function(){this.m_RootObj.load()},t.prototype.update=function(t){this.m_RootObj.update(t)},t.prototype.render=function(t){this.m_RootObj.render(t)},t}();var vt;!function(t){t[t.UNINITILISED=0]="UNINITILISED",t[t.LOADING=1]="LOADING",t[t.UPDATING=2]="UPDATING"}(vt||(vt={}));var gt=function(){function t(t,e,o){this.m_State=vt.UNINITILISED,this.m_GlobalId=-1,this.m_Id=t,this.m_Descritpion=o,this.m_Name=e,this.m_Scene=new yt}return Object.defineProperty(t.prototype,"id",{get:function(){return this.m_Id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.m_Name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this.m_Descritpion},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this.m_Scene},enumerable:!1,configurable:!0}),t.prototype.init=function(t){if(void 0===t.objects)throw new Error("Level init error: objects are missing");for(var e in t.objects){var o=t.objects[e];this.loadSimObject(o,this.m_Scene.root)}},t.prototype.load=function(){this.m_State=vt.LOADING,this.m_Scene.load(),this.m_State=vt.UPDATING},t.prototype.unload=function(){},t.prototype.update=function(t){this.m_State===vt.UPDATING&&this.m_Scene.update(t)},t.prototype.render=function(t){this.m_State===vt.UPDATING&&this.m_Scene.render(t)},t.prototype.onActivated=function(){},t.prototype.onDeactived=function(){},t.prototype.loadSimObject=function(t,e){var o;void 0!==t.name&&(o=String(t.name)),this.m_GlobalId++;var n=new lt(this.m_GlobalId,o,this.m_Scene);if(void 0!==t.transform&&n.Transform.setFromJson(t.transform),void 0!==t.components)for(var r in t.components){var i=t.components[r],s=ht.extractComponent(i);console.log(s),n.addComponent(s)}if(void 0!==t.behaviours)for(var a in t.behaviours){i=t.behaviours[a];var u=z.extractBehaviour(i);n.addBehaviour(u)}if(void 0!==t.children)for(var m in t.children){var c=t.children[m];this.loadSimObject(c,n)}void 0!==e&&e.addChild(n)},t}();const bt=gt;const wt=function(){function t(){}return t.init=function(){t.m_Instance=new t,t.m_RegisteredLevels[0]="../../assets/levels/testLevel.json"},t.changeLevel=function(e){if(void 0!==t.m_ActiveLevel&&(t.m_ActiveLevel.onDeactived(),t.m_ActiveLevel.unload(),t.m_ActiveLevel=void 0),void 0===t.m_RegisteredLevels[e])throw new Error("Level with id ".concat(e," doesn't exist."));if(_.isAssetLoaded(t.m_RegisteredLevels[e])){var o=_.getAsset(t.m_RegisteredLevels[e]);t.loadLevel(o)}else m.subscribe(p+t.m_RegisteredLevels[e],t.m_Instance),_.loadAsset(t.m_RegisteredLevels[e])},t.update=function(e){void 0!==t.m_ActiveLevel&&t.m_ActiveLevel.update(e)},t.render=function(e){void 0!==t.m_ActiveLevel&&t.m_ActiveLevel.render(e)},t.loadLevel=function(e){var o,n,r,i=e.Data;if(void 0===i.id)throw new Error("Level id missing");if(o=Number(i.id),void 0===i.name)throw new Error("Level name missing");n=String(i.name),void 0!==i.description&&(r=String(i.description)),t.m_ActiveLevel=new bt(o,n,r),t.m_ActiveLevel.init(i),t.m_ActiveLevel.onActivated(),t.m_ActiveLevel.load()},t.prototype.onMessage=function(e){if(-1!==e.Code.indexOf(p)){var o=e.Context;t.loadLevel(o)}},t.m_GlobalLevelId=-1,t.m_RegisteredLevels={},t}();var Tt=function(){function t(t,e){this.m_Player=new Audio(t),this.m_Player.loop=e}return Object.defineProperty(t.prototype,"loop",{get:function(){return this.m_Player.loop},set:function(t){this.m_Player.loop=t},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.m_Player=void 0},t.prototype.play=function(){this.m_Player.paused||this.stop(),this.m_Player.play()},t.prototype.pause=function(){this.m_Player.pause()},t.prototype.stop=function(){this.m_Player.pause(),this.m_Player.currentTime=0},t}();const At=function(){function t(){}return t.loadSoundFile=function(e,o,n){t.m_SoundEffects[e]=new Tt(o,n)},t.playSound=function(e){void 0!==t.m_SoundEffects[e]&&t.m_SoundEffects[e].play()},t.pauseSound=function(e){void 0!==t.m_SoundEffects[e]&&t.m_SoundEffects[e].pause()},t.pauseAll=function(){for(var e in t.m_SoundEffects)t.m_SoundEffects[e].pause()},t.stopSound=function(e){void 0!==t.m_SoundEffects[e]&&t.m_SoundEffects[e].stop()},t.stopAll=function(){for(var e in t.m_SoundEffects)t.m_SoundEffects[e].stop()},t.m_SoundEffects={},t}(),St=function(){function o(){this.m_PreviousTime=0}return o.prototype.start=function(){this.m_Canvas=e.init(),_.init(),B.init(),wt.init(),ht.init(),z.init(),m.subscribe("MOUSE_UP",this),t.clearColor(0,0,.8,1),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.m_BasicShader=new g,this.m_BasicShader.use(),this.m_Projection=r(),this.m_Projection=i(this.m_Projection,0,this.m_Canvas.width,this.m_Canvas.height,0,-100,100),T.registerMaterial(new M("crate","../assets/textures/crate.jpg",new L(255,255,255,255))),T.registerMaterial(new M("duck","../assets/textures/duck.png",new L(255,255,255,255))),At.loadSoundFile("flap","../assets/audio/flap.mp3",!1),wt.changeLevel(0),this.resize(),this.loop()},o.prototype.resize=function(){void 0!==this.m_Canvas&&(this.m_Canvas.width=window.innerWidth,this.m_Canvas.height=window.innerHeight),t.viewport(0,0,this.m_Canvas.width,this.m_Canvas.height),this.m_Projection=i(this.m_Projection,0,this.m_Canvas.width,this.m_Canvas.height,0,-100,100)},o.prototype.loop=function(){this.update(),this.render()},o.prototype.update=function(){var t=performance.now()-this.m_PreviousTime;a.update(t),wt.update(t),this.m_PreviousTime=performance.now()},o.prototype.render=function(){t.clear(t.COLOR_BUFFER_BIT);var e=this.m_BasicShader.getUniformLocation("u_projection");t.uniformMatrix4fv(e,!1,new Float32Array(this.m_Projection)),wt.render(this.m_BasicShader),requestAnimationFrame(this.loop.bind(this))},o.prototype.onMessage=function(t){if("MOUSE_UP"===t.Code){var e=t.Context;document.title="Pos: ".concat(e.position[0],", ").concat(e.position[1]),At.playSound("flap")}},o}();var Pt;window.onload=function(){(Pt=new St).start()},window.onresize=function(){Pt.resize()}})();