(()=>{"use strict";var e,t=function(){function t(){}return t.init=function(t){var n;if(void 0!==t){if(void 0===(n=document.getElementById(t)))throw new Error("Cannot find a canvas element of id: "+t)}else n=document.createElement("canvas"),document.body.appendChild(n);if(void 0===(e=n.getContext("webgl2")))throw new Error("Unable to initilise WebGL2");return n},t}(),n="undefined"!=typeof Float32Array?Float32Array:Array;function o(){var e=new n(16);return n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var r=function(e,t,n,o,r,i,a){var s=1/(t-n),u=1/(o-r),c=1/(i-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(r+o)*u,e[14]=(a+i)*c,e[15]=1,e};const i=function(e,t){this.Message=e,this.Handler=t},a=function(){function e(){}return e.addSubscription=function(t,n){void 0===e.m_Subscriptions[t]&&(e.m_Subscriptions[t]=[]),-1!==e.m_Subscriptions[t].indexOf(n)?console.warn("Attempting to add duplicate handler to code ".concat(t,". Subscription not added")):e.m_Subscriptions[t].push(n)},e.removeSubscription=function(t,n){if(void 0!==e.m_Subscriptions[t]){var o=e.m_Subscriptions[t].indexOf(n);-1!==o&&e.m_Subscriptions[t].splice(o,1)}else console.warn("Can't unsubscribe thandelr from code ".concat(t,", because this code is not subscribed to."))},e.post=function(t){console.log("Message posted",t),void 0!==e.m_Subscriptions[t.Code]&&e.m_Subscriptions[t.Code].forEach((function(n){t.Priority===s.HIGH?n.onMessage(t):e.m_MessageQueue.push(new i(t,n))}))},e.update=function(t){if(0!=e.m_MessageQueue.length)for(var n=Math.min(e.m_QueueLimitPerFrame,e.m_MessageQueue.length),o=0;o<n;++o){var r=e.m_MessageQueue.pop();r.Handler.onMessage(r.Message)}},e.m_Subscriptions={},e.m_QueueLimitPerFrame=10,e.m_MessageQueue=[],e}();var s;!function(e){e[e.NORMAL=0]="NORMAL",e[e.HIGH=1]="HIGH"}(s||(s={}));const u=function(){function e(e,t,n,o){void 0===o&&(o=s.NORMAL),this.Code=e,this.Sender=t,this.Priority=o,this.Context=n}return e.send=function(t,n,o){a.post(new e(t,n,o))},e.sendPriority=function(t,n,o){a.post(new e(t,n,o,s.HIGH))},e.subscribe=function(e,t){a.addSubscription(e,t)},e.unsubscribe=function(e,t){a.removeSubscription(e,t)},e}();var c=function(){function e(e,t){this.Name=e,this.Data=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this.Data.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.Data.height},enumerable:!1,configurable:!0}),e}();const m=function(){function e(){}return Object.defineProperty(e.prototype,"supportedExts",{get:function(){return["png","gif","jpg"]},enumerable:!1,configurable:!0}),e.prototype.loadAsset=function(e){var t=new Image;t.onload=this.onImageLoaded.bind(this,e,t),t.src=e},e.prototype.onImageLoaded=function(e,t){console.log("onImage loaded ".concat(e,"/").concat(t));var n=new c(e,t);_.onAssetLoaded(n)},e}();var d=function(e,t){this.Name=e,this.Data=t};const f=function(){function e(){}return Object.defineProperty(e.prototype,"supportedExts",{get:function(){return["json"]},enumerable:!1,configurable:!0}),e.prototype.loadAsset=function(e){var t=new XMLHttpRequest;t.open("GET",e),t.addEventListener("load",this.onJsonLoaded.bind(this,e,t)),t.send()},e.prototype.onJsonLoaded=function(e,t){if(console.log("onJsonLoaded loaded",e,t),t.readyState===t.DONE){var n=JSON.parse(t.responseText),o=new d(e,n);_.onAssetLoaded(o)}},e}();var h="MSG_ASSET_LOADER_ASSET_LOADED::";const _=function(){function e(){}return e.init=function(){e.m_Loaders.push(new m),e.m_Loaders.push(new f)},e.registerLoader=function(t){e.m_Loaders.push(t)},e.onAssetLoaded=function(t){e.m_LoadedAssets[t.Name]=t,u.send(h+t.Name,this,t)},e.loadAsset=function(t){for(var n=t.split(".").pop().toLowerCase(),o=0,r=e.m_Loaders;o<r.length;o++){var i=r[o];if(-1!==i.supportedExts.indexOf(n))return void i.loadAsset(t)}console.warn("Unable to load asset with extension ".concat(n,", because there is no loader associated with it."))},e.isAssetLoaded=function(t){return void 0!==e.m_LoadedAssets[t]},e.getAsset=function(t){var n=e.m_LoadedAssets[t];if(void 0!==n)return n;e.loadAsset(t)},e.m_Loaders=[],e.m_LoadedAssets={},e}();var p,l=function(){function t(e){this.m_Attributes={},this.m_Uniforms={},this.m_Name=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this.m_Name},enumerable:!1,configurable:!0}),t.prototype.load=function(t,n){var o=this.loadShader(t,e.VERTEX_SHADER),r=this.loadShader(n,e.FRAGMENT_SHADER);this.createShaderProgram(o,r),this.detectAttributes(),this.detectUniforms()},t.prototype.use=function(){e.useProgram(this.m_Program)},t.prototype.getAttributeLocation=function(e){if(void 0===this.m_Attributes[e])throw new Error("error getting attribute '".concat(e,"' :for ").concat(this.name));return this.m_Attributes[e]},t.prototype.getUniformLocation=function(e){if(void 0===this.m_Uniforms[e])throw new Error("error getting uniform '".concat(e,"' :for ").concat(this.name));return this.m_Uniforms[e]},t.prototype.loadShader=function(t,n){var o=e.createShader(n);if(e.shaderSource(o,t),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){var r=e.getShaderInfoLog(o);throw new Error("error compiling shader '".concat(this.m_Name,"' : ").concat(r))}return o},t.prototype.createShaderProgram=function(t,n){if(this.m_Program=e.createProgram(),e.attachShader(this.m_Program,t),e.attachShader(this.m_Program,n),e.linkProgram(this.m_Program),!e.getProgramParameter(this.m_Program,e.LINK_STATUS)){var o=e.getProgramInfoLog(this.m_Program);throw new Error("error linking shader ".concat(this.m_Name," : ").concat(o))}},t.prototype.detectAttributes=function(){for(var t=e.getProgramParameter(this.m_Program,e.ACTIVE_ATTRIBUTES),n=0;n<t;++n){var o=e.getActiveAttrib(this.m_Program,n);if(!o)break;this.m_Attributes[o.name]=e.getAttribLocation(this.m_Program,o.name)}},t.prototype.detectUniforms=function(){for(var t=e.getProgramParameter(this.m_Program,e.ACTIVE_UNIFORMS),n=0;n<t;++n){var o=e.getActiveUniform(this.m_Program,n);if(!o)break;this.m_Uniforms[o.name]=e.getUniformLocation(this.m_Program,o.name)}},t}(),v=(p=function(e,t){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},p(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});const g=function(e){function t(){var t=e.call(this,"basic")||this;return t.load(t.getVertexSource(),t.getFragmentSource()),t}return v(t,e),t.prototype.getVertexSource=function(){return"#version 300 es\n\n        in vec4 a_position;\n        in vec2 a_texCoord;\n\n        uniform mat4 u_projection;\n        uniform mat4 u_model;\n\n        out vec2 v_texCoord;\n        \n        void main() {\n            gl_Position =  u_projection * u_model * a_position;\n            v_texCoord = a_texCoord;\n        }"},t.prototype.getFragmentSource=function(){return"#version 300 es\n\n        precision highp float;\n\n        uniform vec4 u_tint;\n        uniform sampler2D u_diffuse;\n\n        out vec4 outColor;\n        in vec2 v_texCoord;\n        \n        \n        void main() {\n            outColor = u_tint * texture(u_diffuse, v_texCoord);\n        }"},t}(l);var b=function(e){this.m_ReferenceCount=1,this.m_Material=e},y=function(){function e(){}return e.registerMaterial=function(t){void 0===e.m_Materials[t.name]&&(e.m_Materials[t.name]=new b(t))},e.getMaterial=function(t){return void 0===e.m_Materials[t]?void 0:(e.m_Materials[t].m_ReferenceCount++,e.m_Materials[t].m_Material)},e.releaseMaterial=function(t){void 0===e.m_Materials[t]?console.warn("Can't release material that hasn't been registered"):(e.m_Materials[t].m_ReferenceCount--,e.m_Materials[t].m_ReferenceCount<1&&(e.m_Materials[t].m_Material.destroy(),e.m_Materials[t].m_Material=void 0,delete e.m_Materials[t]))},e.m_Materials={},e}();const T=y;var A=0,P=0,x=new Uint8Array([255,255,255,255]);const L=function(){function t(t,n,o){void 0===n&&(n=1),void 0===o&&(o=1),this.m_IsLoaded=!1,this.m_Name=t,this.m_Width=n,this.m_Height=o,this.m_Handle=e.createTexture(),u.subscribe(h+this.m_Name,this),this.bind(),e.texImage2D(e.TEXTURE_2D,A,e.RGBA,1,1,P,e.RGBA,e.UNSIGNED_BYTE,x);var r=_.getAsset(this.m_Name);void 0!==r&&this.loadTextureFromAsset(r)}return t.prototype.destroy=function(){e.deleteTexture(this.m_Handle)},Object.defineProperty(t.prototype,"name",{get:function(){return this.m_Name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this.m_IsLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.m_Width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.m_Height},enumerable:!1,configurable:!0}),t.prototype.bind=function(){e.bindTexture(e.TEXTURE_2D,this.m_Handle)},t.prototype.unbind=function(){e.bindTexture(e.TEXTURE_2D,void 0)},t.prototype.activateAndBind=function(t){void 0===t&&(t=0),e.activeTexture(e.TEXTURE0+t),this.bind()},t.prototype.onMessage=function(e){e.Code===h+this.m_Name&&(console.debug(this.m_Name+" loaded:",e.Context),this.loadTextureFromAsset(e.Context))},t.prototype.loadTextureFromAsset=function(t){this.m_Width=t.width,this.m_Height=t.height,this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,A,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.Data),this.m_IsLoaded=!0},t}();var w=function(e){this.ReferenceNode=1,this.Texture=e};const S=function(){function e(){}return e.getTexture=function(t){if(void 0===e.m_Textures[t]){var n=new L(t);e.m_Textures[t]=new w(n)}else e.m_Textures[t].ReferenceNode++;return e.m_Textures[t].Texture},e.releaseTexture=function(t){e.m_Textures[t],void 0===e.m_Textures[t]?console.warn("A texture name ".concat(t," doesn't exist, hence can't be released")):(e.m_Textures[t].ReferenceNode--,e.m_Textures[t].ReferenceNode<1&&(e.m_Textures[t].Texture.destroy(),e.m_Textures[t]=void 0,delete e.m_Textures[t]))},e.m_Textures={},e}(),E=function(){function e(e,t,n){this.m_Name=e,this.m_DiffuseTextureName=t,this.m_Tint=n,void 0!==this.m_DiffuseTextureName&&(this.m_DiffuseTexture=S.getTexture(this.m_DiffuseTextureName))}return e.prototype.destroy=function(){S.releaseTexture(this.m_DiffuseTextureName),this.m_DiffuseTexture=void 0},Object.defineProperty(e.prototype,"name",{get:function(){return this.m_Name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"diffuseTexture",{get:function(){return this.m_DiffuseTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this.m_Tint},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"diffuseTexName",{get:function(){return this.m_DiffuseTextureName},set:function(e){void 0!==this.m_DiffuseTexture&&S.releaseTexture(this.m_DiffuseTextureName),this.m_DiffuseTextureName=e,void 0!==this.m_DiffuseTextureName&&S.getTexture(this.m_DiffuseTextureName)},enumerable:!1,configurable:!0}),e}(),O=function(){function e(e,t,n,o){void 0===e&&(e=255),void 0===t&&(t=255),void 0===n&&(n=255),void 0===o&&(o=255),this.m_R=e,this.m_G=t,this.m_B=n,this.m_A=o}return Object.defineProperty(e.prototype,"r",{get:function(){return this.m_R},set:function(e){this.m_R=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rFloat",{get:function(){return this.m_R/255},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"g",{get:function(){return this.m_G},set:function(e){this.m_G=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gFloat",{get:function(){return this.m_G/255},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"b",{get:function(){return this.m_B},set:function(e){this.m_B=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bFloat",{get:function(){return this.m_B/255},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"a",{get:function(){return this.m_A},set:function(e){this.m_A=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aFloat",{get:function(){return this.m_A/255},enumerable:!1,configurable:!0}),e.prototype.toArray=function(){return[this.m_R,this.m_G,this.m_B,this.m_A]},e.prototype.toFloatArray=function(){return[this.m_R/255,this.m_G/255,this.m_B/255,this.m_A/255]},e.prototype.toFloat32Array=function(){return new Float32Array(this.toFloatArray())},e.white=function(){return new e(255,255,255,255)},e.black=function(){return new e(0,0,0,255)},e.red=function(){return new e(255,0,0,255)},e.green=function(){return new e(0,255,0,255)},e.blue=function(){return new e(0,0,255,255)},e}();function R(){var e=new n(3);return n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function M(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}R();var N=function(){function e(){var e;this.Position=R(),this.Rotation=0,this.Scale=(1,1,1,(e=R())[0]=1,e[1]=1,e[2]=1,e)}return e.prototype.copyFrom=function(e){M(this.Position,e.Position),this.Rotation=e.Rotation,M(this.Scale,e.Scale)},e.prototype.getTransformationMatrix=function(){var e,t,n,r,i,a,s,u,c,m,d,f,h,_,p,l,v,g,b=(e=o(),t=o(),l=(n=this.Position)[0],v=n[1],g=n[2],t===e?(e[12]=t[0]*l+t[4]*v+t[8]*g+t[12],e[13]=t[1]*l+t[5]*v+t[9]*g+t[13],e[14]=t[2]*l+t[6]*v+t[10]*g+t[14],e[15]=t[3]*l+t[7]*v+t[11]*g+t[15]):(r=t[0],i=t[1],a=t[2],s=t[3],u=t[4],c=t[5],m=t[6],d=t[7],f=t[8],h=t[9],_=t[10],p=t[11],e[0]=r,e[1]=i,e[2]=a,e[3]=s,e[4]=u,e[5]=c,e[6]=m,e[7]=d,e[8]=f,e[9]=h,e[10]=_,e[11]=p,e[12]=r*l+u*v+f*g+t[12],e[13]=i*l+c*v+h*g+t[13],e[14]=a*l+m*v+_*g+t[14],e[15]=s*l+d*v+p*g+t[15]),e);return function(e,t,n){var o=Math.sin(n),r=Math.cos(n),i=t[0],a=t[1],s=t[2],u=t[3],c=t[4],m=t[5],d=t[6],f=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r+c*o,e[1]=a*r+m*o,e[2]=s*r+d*o,e[3]=u*r+f*o,e[4]=c*r-i*o,e[5]=m*r-a*o,e[6]=d*r-s*o,e[7]=f*r-u*o}(b,b,this.Rotation),function(e,t,n){var o=n[0],r=n[1],i=n[2];e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}(b,b,this.Scale),b},e.prototype.setFromJson=function(e){void 0!==e.position&&(this.Position[0]=e.x,this.Position[1]=e.y,this.Position[2]=e.z),void 0!==e.rotation&&(this.Rotation=e.rotation),void 0!==e.scale&&(this.Scale[0]=e.x,this.Scale[1]=e.y,this.Scale[2]=e.z)},e}();const j=N;var C=function(){function e(e,t,n){this.m_Children=[],this.m_IsLoaded=!1,this.m_LocalMatrix=o(),this.m_WorldMatrix=o(),this.m_Components=[],this.Transform=new j,this.m_Id=e,this.Name=t,this.m_Scene=n}return Object.defineProperty(e.prototype,"id",{get:function(){return this.m_Id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.m_Parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldMatrix",{get:function(){return this.m_WorldMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return this.m_IsLoaded},enumerable:!1,configurable:!0}),e.prototype.addChild=function(e){e.m_Parent=this,this.m_Children.push(e),e.onAdded(this.m_Scene)},e.prototype.removeChild=function(e){var t=this.m_Children.indexOf(e);-1!==t&&(e.m_Parent=void 0,this.m_Children.splice(t,1))},e.prototype.getObjectByName=function(e){if(this.Name===e)return this;for(var t=0,n=this.m_Children;t<n.length;t++){var o=n[t].getObjectByName(e);if(void 0!==o)return o}},e.prototype.addComponent=function(e){this.m_Components.push(e),e.setOwner(this)},e.prototype.load=function(){this.m_IsLoaded=!0;for(var e=0,t=this.m_Components;e<t.length;e++)t[e].load();for(var n=0,o=this.m_Children;n<o.length;n++)o[n].load()},e.prototype.update=function(e){this.m_LocalMatrix=this.Transform.getTransformationMatrix(),this.updateWorldMatrix(void 0!==this.m_Parent?this.m_Parent.worldMatrix:void 0);for(var t=0,n=this.m_Components;t<n.length;t++)n[t].update(e);for(var o=0,r=this.m_Children;o<r.length;o++)r[o].update(e)},e.prototype.render=function(e){for(var t=0,n=this.m_Components;t<n.length;t++)n[t].render(e);for(var o=0,r=this.m_Children;o<r.length;o++)r[o].render(e)},e.prototype.updateWorldMatrix=function(e){var t,n;void 0!==e?function(e,t,n){var o=t[0],r=t[1],i=t[2],a=t[3],s=t[4],u=t[5],c=t[6],m=t[7],d=t[8],f=t[9],h=t[10],_=t[11],p=t[12],l=t[13],v=t[14],g=t[15],b=n[0],y=n[1],T=n[2],A=n[3];e[0]=b*o+y*s+T*d+A*p,e[1]=b*r+y*u+T*f+A*l,e[2]=b*i+y*c+T*h+A*v,e[3]=b*a+y*m+T*_+A*g,b=n[4],y=n[5],T=n[6],A=n[7],e[4]=b*o+y*s+T*d+A*p,e[5]=b*r+y*u+T*f+A*l,e[6]=b*i+y*c+T*h+A*v,e[7]=b*a+y*m+T*_+A*g,b=n[8],y=n[9],T=n[10],A=n[11],e[8]=b*o+y*s+T*d+A*p,e[9]=b*r+y*u+T*f+A*l,e[10]=b*i+y*c+T*h+A*v,e[11]=b*a+y*m+T*_+A*g,b=n[12],y=n[13],T=n[14],A=n[15],e[12]=b*o+y*s+T*d+A*p,e[13]=b*r+y*u+T*f+A*l,e[14]=b*i+y*c+T*h+A*v,e[15]=b*a+y*m+T*_+A*g}(this.worldMatrix,e,this.m_LocalMatrix):(t=this.m_WorldMatrix,n=this.m_LocalMatrix,t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15])},e.prototype.onAdded=function(e){this.m_Scene=e},e}();const I=C;const D=function(){function e(){this.m_RootObj=new I(0,"__ROOT__",this)}return Object.defineProperty(e.prototype,"root",{get:function(){return this.m_RootObj},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return this.m_RootObj.isLoaded},enumerable:!1,configurable:!0}),e.prototype.addObject=function(e){this.m_RootObj.addChild(e)},e.prototype.getObjectByName=function(e){return this.m_RootObj.getObjectByName(e)},e.prototype.load=function(){this.m_RootObj.load()},e.prototype.update=function(e){this.m_RootObj.update(e)},e.prototype.render=function(e){this.m_RootObj.render(e)},e}();var U;!function(e){e[e.UNINITILISED=0]="UNINITILISED",e[e.LOADING=1]="LOADING",e[e.UPDATING=2]="UPDATING"}(U||(U={}));const G=function(){function e(e,t,n){this.m_State=U.UNINITILISED,this.m_GlobalId=-1,this.m_Id=e,this.m_Descritpion=n,this.m_Name=t,this.m_Scene=new D}return Object.defineProperty(e.prototype,"id",{get:function(){return this.m_Id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.m_Name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this.m_Descritpion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this.m_Scene},enumerable:!1,configurable:!0}),e.prototype.init=function(e){if(void 0===e.objects)throw new Error("Level init error: objects are missing");for(var t in e.objects){var n=e.obejcts[t];this.loadSimObject(n,this.m_Scene.root)}},e.prototype.load=function(){this.m_State=U.LOADING,this.m_Scene.load(),this.m_State=U.UPDATING},e.prototype.unload=function(){},e.prototype.update=function(e){this.m_State===U.UPDATING&&this.m_Scene.update(e)},e.prototype.render=function(e){this.m_State===U.UPDATING&&this.m_Scene.render(e)},e.prototype.onActivated=function(){},e.prototype.onDeactived=function(){},e.prototype.loadSimObject=function(e,t){var n;void 0!==e.name&&(n=String(e.name)),this.m_GlobalId++;var o=new I(this.m_GlobalId,n,this.m_Scene);if(void 0!==e.transform&&o.Transform.setFromJson(e.transform),void 0!==e.children)for(var r in e.children){var i=e.children[r];this.loadSimObject(i,o)}void 0!==t&&t.addChild(o)},e}();const F=function(){function e(){}return e.init=function(){e.m_Instance=new e,e.m_RegisteredLevels[0]="src/assets/levels/testLevel.json"},e.changeLevel=function(t){if(void 0!==e.m_ActiveLevel&&(e.m_ActiveLevel.onDeactived(),e.m_ActiveLevel.unload(),e.m_ActiveLevel=void 0),void 0===e.m_RegisteredLevels[t])throw new Error("Level with id ".concat(t," doesn't exist."));if(_.isAssetLoaded(e.m_RegisteredLevels[t])){var n=_.getAsset(e.m_RegisteredLevels[t]);e.loadLevel(n)}else u.subscribe(h+e.m_RegisteredLevels[t],e.m_Instance.onMessage.bind(e.m_Instance)),_.loadAsset(e.m_RegisteredLevels[t])},e.update=function(t){void 0!==e.m_ActiveLevel&&e.m_ActiveLevel.update(t)},e.render=function(t){void 0!==e.m_ActiveLevel&&e.m_ActiveLevel.render(t)},e.loadLevel=function(t){var n,o,r,i=t.Data;if(void 0===i.id)throw new Error("Level id missing");if(n=Number(i.id),void 0===i.name)throw new Error("Level name missing");o=String(i.name),void 0!==i.description&&(r=String(i.description)),e.m_ActiveLevel=new G(n,o,r),e.m_ActiveLevel.init(i),e.m_ActiveLevel.onActivated(),e.m_ActiveLevel.load()},e.prototype.onMessage=function(t){if(t.Code.indexOf(h)){var n=t.Context;e.loadLevel(n)}},e.m_GlobalLevelId=-1,e.m_RegisteredLevels={},e}(),B=function(){function n(){}return n.prototype.start=function(){this.m_Canvas=t.init(),_.init(),F.init(),e.clearColor(0,0,0,1),this.m_BasicShader=new g,this.m_BasicShader.use(),this.m_Projection=o(),this.m_Projection=r(this.m_Projection,0,this.m_Canvas.width,this.m_Canvas.height,0,-100,100),T.registerMaterial(new E("crate","../assets/textures/crate.jpg",new O(255,128,0,255))),F.changeLevel(0),this.resize(),this.loop()},n.prototype.resize=function(){void 0!==this.m_Canvas&&(this.m_Canvas.width=window.innerWidth,this.m_Canvas.height=window.innerHeight),e.viewport(0,0,this.m_Canvas.width,this.m_Canvas.height),this.m_Projection=r(this.m_Projection,0,this.m_Canvas.width,this.m_Canvas.height,0,-100,100)},n.prototype.loop=function(){a.update(0),F.update(0),e.clear(e.COLOR_BUFFER_BIT);var t=this.m_BasicShader.getUniformLocation("u_projection");e.uniformMatrix4fv(t,!1,new Float32Array(this.m_Projection)),F.render(this.m_BasicShader),requestAnimationFrame(this.loop.bind(this))},n}();var H;window.onload=function(){(H=new B).start()},window.onresize=function(){H.resize()}})();